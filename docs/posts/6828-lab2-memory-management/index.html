<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[6.828] Lab 2: Memory Management | okie dokie</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
      <li><a href="/">Home</a></li>
      
      <li><a href="/posts">All posts</a></li>
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">[6.828] Lab 2: Memory Management</span></h1>

<h2 class="date">2024/01/13</h2>
</div>

<main>
<p>虚拟地址(VA) -&gt; 线性地址(LA) -&gt; 物理地址(PA)</p>
<pre tabindex="0"><code>           Selector  +--------------+         +-----------+
          ----------&gt;|              |         |           |
                     | Segmentation |         |  Paging   |
Software             |              |--------&gt;|           |----------&gt;  RAM
            Offset   |  Mechanism   |         | Mechanism |
          ----------&gt;|              |         |           |
                     +--------------+         +-----------+
            Virtual                   Linear                Physical
</code></pre><p>IA-32e 分页机制：</p>
<p><img src="https://pdos.csail.mit.edu/6.828/2018/readings/i386/fig5-12.gif" alt=""></p>
<p>一般如 c 语言的指针 CS:IP（<a href="https://en.wikipedia.org/wiki/X86#32-bit">寄存器大小</a>），实模式下通过 CS&laquo;4+IP 得到 20-bit 的物理地址，而保护模式+开启分页下的寻址过程为：</p>
<blockquote>
<p>1、段寄存器硬件设计实际有 48-bit，16-bit 的 visible part 和 32-bit 的 invisible part，16-bit 存 segment selector，通过 selector 去 GDT 找 segment descriptor，GDT 的位置由 GDTR 寄存器给出，找完之后 descriptor 会缓存到 invisible part。</p></blockquote>
<p>selector：</p>
<p><img src="https://pdos.csail.mit.edu/6.828/2018/readings/i386/fig5-6.gif" alt=""></p>
<p>descriptor：</p>
<p><img src="https://pdos.csail.mit.edu/6.828/2018/readings/i386/fig5-3.gif" alt=""></p>
<blockquote>
<p>2、descriptor.base + VA.offset 得到 LA。</p></blockquote>
<p>LA：</p>
<p><img src="https://pdos.csail.mit.edu/6.828/2018/readings/i386/fig5-8.gif" alt=""></p>
<blockquote>
<p>3、CR3 寄存器指定 PD 的位置，通过 LA.DIR 去 PD 里找到指定的 PDE(Page Directory Entry)。</p></blockquote>
<blockquote>
<p>4、通过 PDE.31~12 找到 PT 的位置，通过 LA.PAGE 去 PT 里找到指定的 PTE（Page Table Entry）。</p></blockquote>
<p>PTE：</p>
<p><img src="https://pdos.csail.mit.edu/6.828/2018/readings/i386/fig5-10.gif" alt=""></p>
<blockquote>
<p>5、最终 PTE.31~12 + LA.OFFSET 就是 PA。</p></blockquote>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

